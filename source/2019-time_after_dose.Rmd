---
title: "Time after dose"
---


```{r events_setup, echo=FALSE,message=FALSE}
knitr::opts_chunk$set(echo = TRUE,comment='.',fig.align="center",message=FALSE,cache=FALSE, autodep=TRUE)
```

```{r setup2}
library(mrgsolve)
library(dplyr)
options(mrgsolve.soloc="build")
```

This post will show you how to get time after dose into your simulation, including
an alternate approach that is new in version 0.9.0.  

# Use `tad`  argument to mrgsim

For a couple of releases now, you have been able to supply the argument `tad`
to the mrgsim call and that would insert a new column (`tad`) into the simulated
output with the time after dose.  For example

```{r}
mod <- modlib("pk1") %>% obsonly

out <- 
  mod %>% 
  ev(amt = 100, ii = 6, total = 4) %>%
  mrgsim(tad = TRUE)


out
```

And checking that `tad` is zero whenever there is a dose
```{r}
filter(out, time %in% seq(0,24,6))
```

This is convenience because you can ask for time after dose at run time and 
you don't need any special coding inside the model itself. 


# Use `self.tad()` inside the model

New in 0.9.0 is a function that calculates time after dose and allow 
you to use that information inside the model itself. 

```{r, include = FALSE}
code <- '
$PARAM CL = 1, V = 20

$PKMODEL  cmt="CENT", depot = FALSE

$TABLE 

capture tad = self.tad();

capture flag = tad >= 3;

'
```


```{c, eval=FALSE, code = code}

```


```{r}
mod <- mcode_cache("tad", code)
```

```{r}
out <- 
  mod %>% 
  ev(amt = 100) %>%
  mrgsim()


out
```











