<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>A Complete Example</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="css/styles.css" type="text/css" />
<link rel="stylesheet" href="css/colors.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"><div class = mrgg>mrgsolve::blog</div></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="https://mrgsolve.github.io/vignettes">Vignettes</a>
</li>
<li>
  <a href="https://mrgsolve.github.io/blog">Blog</a>
</li>
<li>
  <a href="https://github.com/mrgsolve/gallery">Gallery</a>
</li>
<li>
  <a href="https://github.com/mrgsolve/blog">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://mrgsolve.github.io/user_guide">UserGuide</a>
</li>
<li>
  <a href="https://github.com/metrumresearchgroup/mrgsolve">GitHub</a>
</li>
<li>
  <a href="https://mrgsolve.github.io">mrgsolve.github.io</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">A Complete Example</h1>

</div>


<div id="introduction" class="section level2">
<h2><span class="header-section-number">0.1</span> Introduction</h2>
<p>We had a user who was learning <code>mrgsolve</code> ask for a “complete example”. I wasn’t sure what exactly that meant, but I created this example and I’m sharing it today on the blog.</p>
<p>This is an invented example to illustrate features and workflow for <code>mrgsolve</code>. If you attend one of our training workshops, we work examples using published models to answer real questions you’ll encounter in drug development. So compared to the workshop material, this is a bit contrived. But I wanted to show how you might tackle a problem involving a population model from end to end.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mrgsolve)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(dmutate)
<span class="kw">library</span>(ggplot2)</code></pre></div>
</div>
<div id="population-pk-model" class="section level2">
<h2><span class="header-section-number">0.2</span> Population PK model</h2>
<ul>
<li>One compartment with first order absorption</li>
<li>There are no ODEs in this model; the system is advanced for each time step through closed-form equations for the amount in each compartment</li>
<li>Covariates: weight on clearances and volumes, sex on volume</li>
<li>Log-normally distributed random effects on <code>CL</code>, <code>V</code>, and <code>KA</code></li>
<li>Reduced bioavailability fraction for oral doses</li>
<li>Lag time for oral doses</li>
<li>Combined additive and proportional error model
<ul>
<li>Note: we resimulate residual error variates using <code>simeps</code> until the simulated concentration is positive</li>
</ul></li>
</ul>
<p><strong>Here’s the model specification</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">code &lt;-<span class="st"> &#39;</span>
<span class="st">$PARAM TVCL = 1.23, TVV = 35.7, TVKA = 1.3</span>
<span class="st">F1 = 0.82, ALAG = 1.21</span>
<span class="st">WT = 70, SEX = 0</span>

<span class="st">$MAIN</span>
<span class="st">double CL = TVCL*pow(WT/70,0.75)*exp(ECL);</span>
<span class="st">double V  = TVV*(WT/70)*exp(EV);</span>
<span class="st">double KA = TVKA*exp(EKA);</span>

<span class="st">if(SEX==1) V = V*0.8;</span>

<span class="st">F_GUT = F1;</span>
<span class="st">ALAG_GUT = ALAG;</span>

<span class="st">$PKMODEL cmt=&quot;GUT CENT&quot;, depot=TRUE</span>

<span class="st">$OMEGA @labels ECL EV EKA</span>
<span class="st">0.015 0.2 0.5</span>

<span class="st">$SIGMA @labels PROP ADD</span>
<span class="st">0.03 230</span>

<span class="st">$TABLE</span>
<span class="st">capture IPRED = CENT/(V/1000);</span>
<span class="st">capture DV = IPRED*(1+PROP)+ADD;</span>

<span class="st">while(DV &lt; 0) {</span>
<span class="st">  simeps();</span>
<span class="st">  DV = IPRED*(1+PROP)+ADD;</span>
<span class="st">}</span>

<span class="st">$CAPTURE WT CL </span>
<span class="st">&#39;</span></code></pre></div>
<p><strong>Compile and load the model</strong></p>
<p>We use <code>mcode_cache</code> here, which caches the model when you compile. If the cache is not invalidated, <code>mrgsolve</code> loads from the cache next time rather than re-compiling.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod &lt;-<span class="st"> </span><span class="kw">mcode_cache</span>(<span class="st">&quot;demo&quot;</span>, code)</code></pre></div>
</div>
<div id="input-data-set" class="section level2">
<h2><span class="header-section-number">0.3</span> Input data set</h2>
<ul>
<li><code>N=2000</code> patients are simulated in this example</li>
<li>We simulate patient-level weight and sex using the <a href="https://github.com/kylebmetrum/dmutate"><code>dmutate</code></a> package</li>
<li>We create a flag in the data set for patients with weight greater than 90 kg</li>
<li>Patients with weight less than 90 kg get a certain dose while patients with weight greater than 90 kg get a higher dose</li>
<li>Dosing proceeds Q24H x 10 doses</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">33020</span>)
idata &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">data_frame</span>(<span class="dt">ID=</span><span class="dv">1</span><span class="op">:</span><span class="dv">2000</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate_random</span>(WT[<span class="dv">50</span>,<span class="dv">110</span>] <span class="op">~</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">80</span>,<span class="dv">30</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate_random</span>(SEX <span class="op">~</span><span class="st"> </span><span class="kw">rbinomial</span>(<span class="fl">0.7</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dosegr =</span> <span class="kw">as.integer</span>(WT <span class="op">&gt;</span><span class="st"> </span><span class="dv">90</span>))

idata</code></pre></div>
<pre><code>. # A tibble: 2,000 x 4
.       ID    WT   SEX dosegr
.    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;int&gt;
.  1     1  52.6     0      0
.  2     2  83.7     1      0
.  3     3  51.9     1      0
.  4     4  94.7     0      1
.  5     5  97.8     1      1
.  6     6  57.1     1      0
.  7     7 101.      0      1
.  8     8  73.0     0      0
.  9     9  56.3     1      0
. 10    10  69.7     1      0
. # … with 1,990 more rows</code></pre>
<p>The dosing elements are implemented through <code>event</code> objects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ev1 &lt;-<span class="st"> </span><span class="kw">ev</span>(<span class="dt">amt=</span><span class="dv">100</span>, <span class="dt">ii=</span><span class="dv">24</span>, <span class="dt">addl=</span><span class="dv">9</span>)
ev2 &lt;-<span class="st"> </span><span class="kw">ev</span>(<span class="dt">amt=</span><span class="dv">150</span>, <span class="dt">ii=</span><span class="dv">24</span>, <span class="dt">addl=</span><span class="dv">9</span>)</code></pre></div>
<p>The <code>assign_ev</code> function looks at the <code>dosegr</code> column in <code>idata</code> and assigns a dosing event sequence (<code>e1</code> or <code>e2</code>) based on the value of <code>dosegr</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">assign_ev</span>(<span class="kw">list</span>(ev1,ev2),idata,<span class="st">&quot;dosegr&quot;</span>)

<span class="kw">head</span>(data)</code></pre></div>
<pre><code>.   time cmt amt evid ii addl ID
. 1    0   1 100    1 24    9  1
. 2    0   1 100    1 24    9  2
. 3    0   1 100    1 24    9  3
. 4    0   1 150    1 24    9  4
. 5    0   1 150    1 24    9  5
. 6    0   1 100    1 24    9  6</code></pre>
<p><strong>NOTE</strong>: this is just one way to set up a <code>data_set</code> for <code>mrgsolve</code>. It might not be the best approach for your problem: maybe it’s too complicated, maybe not complicated enough. See other examples in the blog about creating input data sets or using event objects in your simulations.</p>
</div>
<div id="simulation" class="section level2">
<h2><span class="header-section-number">0.4</span> Simulation</h2>
<ul>
<li>We “carry” (copy) the dose group indicator into the simulated output (<code>carry_out</code>)</li>
<li>Also, we only collect observation records in the output (<code>obsonly</code>)</li>
<li><code>mrgsolve</code> respects the seed you set in <code>R</code> using <code>set.seed</code> so that results are reproducible</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">11009</span>)

out &lt;-<span class="st"> </span>
<span class="st">  </span>mod <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">data_set</span>(data) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">idata_set</span>(idata) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">carry_out</span>(dosegr) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mrgsim</span>(<span class="dt">delta=</span><span class="dv">1</span>, <span class="dt">end=</span><span class="dv">360</span>, <span class="dt">obsonly=</span><span class="ot">TRUE</span>)

out</code></pre></div>
<pre><code>. Model:  demo 
. Dim:    722000 x 9 
. Time:   0 to 360 
. ID:     2000 
.      ID time dosegr      GUT  CENT    WT     CL IPRED      DV
. [1,]  1    0      0  0.00000  0.00 52.56 0.9589     0   19.92
. [2,]  1    1      0  0.00000  0.00 52.56 0.9589     0   12.37
. [3,]  1    2      0 29.31933 51.23 52.56 0.9589  3236 1954.41
. [4,]  1    3      0  7.97557 68.80 52.56 0.9589  4345 5355.78
. [5,]  1    4      0  2.16955 70.36 52.56 0.9589  4443 3438.75
. [6,]  1    5      0  0.59017 67.74 52.56 0.9589  4278 3689.13
. [7,]  1    6      0  0.16054 64.18 52.56 0.9589  4053 4843.27
. [8,]  1    7      0  0.04367 60.52 52.56 0.9589  3822 5287.74</code></pre>
</div>
<div id="output-presentation" class="section level2">
<h2><span class="header-section-number">0.5</span> Output presentation</h2>
<ul>
<li>For some plots, we use a <code>plot</code> method for <code>mrgsims</code> objects (the object that is returned from the <code>mrgsim</code> function</li>
<li>For the other plots, it’s really just turning the <code>mrgsims</code> object into a <code>data.frame</code> and have at it with <code>ggplot2</code></li>
<li>Other than the quickie <code>lattice</code>-based plot method that I only use for quick looks at the output, <code>mrgsolve</code> (by design) lets you use packages like <code>dplyr</code> or <code>data.table</code> or <code>ggplot</code> or other great <code>R</code> packages that are already out there for summarizing and plotting data</li>
<li>But notice that <code>mrgsolve</code> provides methods for sending the <code>mrgsims</code> object directly into a <code>dplyr</code> data summary pipeline</li>
</ul>
<p>This shows the plot method for <code>mrgsims</code> objects</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(out, IPRED<span class="op">+</span>DV<span class="op">~</span>., <span class="dt">subset=</span>ID<span class="op">==</span><span class="dv">10</span>)</code></pre></div>
<p><img src="2017-complete-example_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The <code>mrgsims</code> object can be passed right into <code>dplyr::filter</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tr &lt;-<span class="st"> </span><span class="kw">filter</span>(out, time<span class="op">==</span><span class="dv">240</span>)</code></pre></div>
<p>Simulated day 10 concentration versus patient weight by dose/weight group</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tr, <span class="kw">aes</span>(<span class="dt">x=</span>WT,<span class="dt">y=</span>DV)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>dosegr) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;loess&quot;</span>)</code></pre></div>
<p><img src="2017-complete-example_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Density plots of day 10 concentrations in the two dose/weight groups</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tr,<span class="kw">aes</span>(<span class="dt">x=</span>DV,<span class="dt">fill=</span><span class="kw">factor</span>(dosegr))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">alpha=</span><span class="fl">0.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette=</span><span class="st">&quot;Set1&quot;</span>)</code></pre></div>
<p><img src="2017-complete-example_files/figure-html/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="summary" class="section level2">
<h2><span class="header-section-number">0.6</span> Summary</h2>
<p>This example illustrated how to code a population PK model in <code>mrgsolve</code> format, create input data sets with varied dosing and covariate values, simulate, and plot some results. I also hope this example illustrates the design priorities for the <code>mrgsolve</code> workflow: we always try to leverage existing functionality available in <code>R</code> (such as <code>dmutate</code>, <code>dplyr</code> and <code>ggplot</code>) rather than re-creating our own inside the <code>mrgsolve</code> package. This might require you to write some more code, but ultimately it gives greater flexibility to get the simulation that you need for your project.</p>
<p>We regularly do work with models that are more complicated and design simulations that have bigger demands than this example here. We’d be happy to discuss more-complicated applications that you might be needing for your project work. For now we hope this example will give you some ideas how you can add complexity to your simulation project today.</p>
</div>

<hr>
<p>
  mrgsolve: <a href="https://mrgsolve.github.io">mrgsolve.github.io</a> | 
  Metrum Research Group: <a href="https://metrumrg.com">metrumrg.com</a></p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
